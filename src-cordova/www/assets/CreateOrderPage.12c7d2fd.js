import{V as I,l as c,a_ as q,au as S,aA as x,Y as C,Z as o,F as r,y as b,a4 as l,b3 as U,c5 as E,bR as M,J as P,aG as T,bs as p}from"./index.04da5061.js";import{Q as L}from"./QInnerLoading.2f6f0a31.js";import{Q as N}from"./QImg.92443abc.js";import{Q as R}from"./QPagination.b5e3548d.js";import{Q as j}from"./QTable.37fed2cf.js";import{i as $}from"./index.360ce4ab.js";import{u as G}from"./userAuth.904d0068.js";import{u as J}from"./userCart.b61590df.js";import{u as W}from"./useToast.b6eea3d0.js";import"./format.a33550d6.js";import"./QList.e7fa38c4.js";import"./QSelect.196c6766.js";import"./QItemSection.57530a0e.js";import"./QItemLabel.2d926680.js";import"./position-engine.e88a9c71.js";import"./selection.8a72d576.js";import"./rtl.b51694b1.js";import"./axios.f1f32898.js";async function Y({name:_="",id:n,page:v=1}){const{data:d}=await $.get(`/comercio-ofertas?comercio_id=${n}&nombre=${_}&page=${v}`);return d}async function Z({comercio_id:_,total_descuento:n,ofertas:v,total:d,client_id:u}){const{data:f}=await $.post("/cliente-comercio-ofertas",{comercio_id:_,total_descuento:n,ofertas:v,total:d,client_id:u});return f}const H={class:"q-ma-md"},K={class:"q-ma-md body-small",style:{color:"#363636"}},X={class:"orderContainer"},ee={class:"full-height q-mx-md"},te={class:"full-width q-mb-lg row justify-center q-mt-lg"},ae={class:"containerCard"},oe={class:""},le={class:"text-center column"},ne={class:"q-ma-none text-weight-medium"},se={class:"q-ma-none text-weight-medium"},re={class:"q-ma-none"},ie={class:"q-ma-none"},ce=o("p",{class:"q-ma-none"},"F/l:",-1),de={class:"q-ma-none"},ue={class:"row items-center"},me={class:"q-ma-none text-weight-medium"},ve={class:"buttonAdd"},fe={class:"q-pa-lg flex flex-center"},pe={class:"full-width"},_e={class:"q-pa-md"},ge=o("p",{class:"q-ma-none"},"Total",-1),he=o("p",{class:"q-ma-none"},"Descuento",-1),be={class:"buttonActions"},Ue={__name:"CreateOrderPage",setup(_){const{triggerPositive:n,triggerWarning:v}=W(),d=J(),u=I(()=>d.client),{user:f}=G();console.log(f.value,"user");const m=c(""),g=c([]),y=c(!1),Q=c(1),h=c(1),i=c([]),s=c([]);async function V(){const t=s.value.map(e=>({id:e.id,cantidad:e.cantidad}));try{await Z({comercio_id:f.value.id,total_descuento:10,ofertas:t,total:1,client_id:d.client.id}),n("Factura creada")}catch(e){console.error(e),v("Error al crear la factura")}}function z(){const t=s.value.filter(e=>!i.value.some(a=>a.id===e.id));s.value=t,i.value.length>0&&n("Producto eliminado")}function B(t){const e=g.value.find(a=>a.id===t);e&&e.cantidad++}function F(t){console.log("restar",t);const e=g.value.find(a=>(console.log(a.id,t),a.id===t));console.log(e,"item"),e&&e.cantidad>1&&e.cantidad--}function O(t){const e=s.value.find(a=>a.id===t.id);e?(e.cantidad=t.cantidad+e.cantidad,n("Producto agregado")):(s.value.push({id:t.id,cantidad:t.cantidad,nombre:t.nombre,price_total:t.price_total,descuento:t.descuento}),n("Producto agregado"))}async function w(){try{y.value=!0;const t=await Y({name:m.value,page:h.value,id:f.value.id});g.value=await t.data.map(e=>({...e,cantidad:1}))}catch(t){console.error(t)}finally{y.value=!1}}q(m,async t=>{await w()}),q(h,async t=>{await w()}),S(async()=>{w()});const A=[{name:"cantidad",align:"center",label:"Cantidad",field:"cantidad",sortable:!0},{name:"nombre",align:"center",label:"Producto",field:"nombre",sortable:!0},{name:"price_total",label:"Precio",field:"price_total",sortable:!0,format:t=>`$${t}`},{name:"descuento",label:"Descuento",field:"descuento",sortable:!0,format:t=>`${t}%`}];function D(){return i.value.length===0?"":`${i.value.length} record${i.value.length>1?"s":""} selected of ${s.value.length}`}return(t,e)=>(x(),C(P,null,[o("p",H," Cliente: "+r(b(u)?b(u).name:"cliente no ingresado"),1),o("p",K,r(b(u)?"":"Por favor ingrese el cliente a trav\xE9s del QR"),1),o("div",X,[o("div",ee,[o("div",te,[l(M,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=a=>m.value=a),outlined:"",type:"search",label:"Buscar ofertas",color:"primary",class:"full-width"},{append:U(()=>[l(E,{name:"search",modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a)},null,8,["modelValue"])]),_:1},8,["modelValue"])]),o("div",ae,[l(L,{showing:y.value,label:"Por favor espera...","label-class":"text-teal","label-style":"font-size: 1.1em"},null,8,["showing"]),(x(!0),C(P,null,T(g.value,a=>(x(),C("div",{class:"card",key:a.id},[o("div",oe,[l(N,{class:"rounded-borders",src:a.img_array_url[0],"spinner-color":"dark",style:{height:"80px","max-width":"150px"}},null,8,["src"])]),o("div",null,[o("div",le,[o("p",ne,r(a.nombre),1),o("p",se," $"+r(a.price_total),1),o("p",re,"Desct: "+r(a.descuento)+"%",1)])]),o("div",null,[o("p",ie,"stock:"+r(a.stock),1),ce,o("p",de,r(a.fecha_tope_descuento),1)]),o("div",ue,[l(p,{color:"primary",icon:"add",size:"xs",round:"",onClick:k=>B(a.id)},null,8,["onClick"]),o("p",me,r(a.cantidad),1),l(p,{color:"primary",icon:"remove",size:"xs",round:"",onClick:k=>F(a.id)},null,8,["onClick"])]),o("div",ve,[l(p,{onClick:k=>O(a),color:"positive",icon:"add",round:""},null,8,["onClick"])])]))),128))]),o("div",fe,[l(R,{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=a=>h.value=a),max:Q.value},null,8,["modelValue","max"])])]),o("div",pe,[o("div",_e,[ge,he,l(j,{class:"my-sticky-virtscroll-table",flat:"",bordered:"","virtual-scroll":"","virtual-scroll-sticky-size-start":48,title:"Carrito",rows:s.value,columns:A,"row-key":"id","selected-rows-label":D,selection:"multiple",selected:i.value,"onUpdate:selected":e[3]||(e[3]=a=>i.value=a)},null,8,["rows","selected"]),o("div",be,[l(p,{color:"positive",label:"finalizar compra",onClick:V,disable:!b(u)||s.value.length===0},null,8,["disable"]),l(p,{color:"negative",label:"eliminar",onClick:z})])])])])],64))}};export{Ue as default};
