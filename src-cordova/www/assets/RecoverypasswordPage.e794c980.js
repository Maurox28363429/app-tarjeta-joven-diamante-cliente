import{aT as A,r as h,a3 as d,a4 as p,a5 as o,ao as z,aU as B,a6 as u,k as x,an as D,ad as P,ac as I,a9 as F,a7 as N,aa as c,Q as U,ab as L}from"./index.639bd1b3.js";import{u as q,i as C}from"./useToast.aab6b583.js";import{c as Q,a as K,u as T}from"./useValidateForm.c9325e2b.js";import{u as j,g as G}from"./recoveryPasswordStore.44e3c000.js";import"./axios.f1f32898.js";const M={class:"pin-input"},W={class:"pin-input-container"},Z=["value","onKeydown","onInput","data-index"],H={__name:"PinInput",props:{submit:{type:Function,required:!0}},setup(v){const{triggerWarning:l}=q(),s=h(["","","","","","",""]);function m(i,e){const t=i.key;document.querySelector(`[data-index="${e}"]`)&&(t==="Backspace"?(s.value.splice(e,1,""),e>0&&document.querySelector(`[data-index="${e-1}"]`).focus()):t==="ArrowRight"&&e<s.value.length-1?document.querySelector(`[data-index="${e+1}"]`).focus():t==="ArrowLeft"&&e>0&&document.querySelector(`[data-index="${e-1}"]`).focus())}function f(i,e){const t=i.data;t&&t.match(/^[0-9a-zA-Z]$/)?(s.value.splice(e,1,t),e<s.value.length-1&&document.querySelector(`[data-index="${e+1}"]`).focus()):s.value.splice(e,1,"")}function y(i){i.preventDefault();const e=i.clipboardData.getData("text/plain");if(e&&e.match(/^[0-9a-zA-Z]+$/)&&e.length<=s.value.length)for(let t=0;t<e.length;t++)s.value.splice(t,1,e[t]);e.length>s.value.length&&l("El c\xF3digo debe ser de 7 d\xEDgitos.")}return(i,e)=>(d(),p("div",M,[o("div",W,[(d(!0),p(z,null,B(s.value,(t,r)=>(d(),p("input",{key:r,class:"pin-input-box",type:"text",value:t,maxlength:"1",onKeydown:n=>m(n,r),onInput:n=>f(n,r),onPaste:e[0]||(e[0]=n=>y(n)),ref_for:!0,ref:"input-"+r,"data-index":r},null,40,Z))),128))]),u(x,{onClick:e[1]||(e[1]=()=>v.submit(s.value.join(""))),label:"Enviar c\xF3digo",size:"14px",fill:"",height:"48px",color:"primary",class:"full-width q-mb-md",type:"submit"})]))}};var J=A(H,[["__scopeId","data-v-111ae01a"]]);const O="Este campo es requerido",X=Q({password:K().required(O)});function Y({email:v,code:l}){return C.post("/validateRecovery",{email:v,code:l})}function ee({email:v,recovery_cod:l,password:s}){return C.post("/putRecovery",{email:v,recovery_cod:l,password:s})}const te={class:"full-width"},se={class:"full-width row justify-center"},oe={class:"q-pa-md column items-center full-width",style:{"max-width":"400px"}},ae={key:0,class:"full-width column items-center"},re=o("p",{class:"title-large q-mb-xl"},"Verifica tu email",-1),ne=o("p",{class:"text-center"}," Introduce el c\xF3digo enviado a tu correo electr\xF3nico. ",-1),le={class:"full-width"},ie=o("p",null,"\xBFNo has recibido el correo electr\xF3nico?",-1),ce={key:1,class:"full-width column items-center"},ue=o("p",{class:"title-large q-mb-xl"},"Crear nueva contrase\xF1a",-1),de=o("p",{class:"text-center"},"Introduce la nueva contrase\xF1a",-1),pe={class:"full-width"},ve={class:"full-width input"},me={class:"label-large"},_e={key:0,class:"text-error"},be={__name:"RecoverypasswordPage",setup(v){const{triggerPositive:l,triggerWarning:s}=q(),m=h("password"),f=h("visibility_off"),y=()=>{m.value==="password"?(m.value="text",f.value="visibility"):(m.value="password",f.value="visibility_off")},e=j().email,t={password:""},{useForm:r,validatInput:n,validateMessage:g}=T({initialValue:t,schema:X}),k=h(null),b=h(!0),$=D(),S=()=>{console.log("go back"),$.go(-1)},V=async()=>{try{await G({email:e}),l("\xA1C\xF3digo reenviado!, puede tardar unos minutos")}catch{console.log(),s("\xA1Up! Ha ocurrido un error, intento nuevamente")}};console.log(e,"email");const E=async _=>{k.value=_;try{const{data:a}=await Y({email:e,code:_});b.value=!1,console.log(a),l("\xA1C\xF3digo verificado!, ahora puede cambiar su contrase\xF1a.")}catch(a){console.log(a)}},R=async()=>{try{await ee({recovery_cod:k.value,password:r.value.password,email:e}),l("La contrase\xF1a ha sido cambiada exitosamente.")}catch(_){console.log(_),s("\xA1Up! C\xF3dido incorreto, intente de nuevo ")}};return(_,a)=>(d(),p("div",te,[o("div",{onClick:S,class:"full-width q-pl-md q-pt-md"},[u(P,{name:"arrow_back",size:"md",color:"dark",class:"cursor-pointer"})]),o("div",se,[o("div",oe,[b.value?(d(),p("div",ae,[re,ne,o("div",le,[u(J,{submit:E})]),ie,u(x,{onClick:V,label:"Reenviar c\xF3digo",size:"14px",fill:"",height:"48px",color:"secondary",class:"full-width q-mb-md"})])):I("",!0),b.value?I("",!0):(d(),p("div",ce,[ue,de,o("div",pe,[o("div",ve,[o("label",me,[F(" Contrase\xF1a "),u(U,{type:m.value,outlined:"","lazy-rules":"",modelValue:c(r).password,"onUpdate:modelValue":a[1]||(a[1]=w=>c(r).password=w),placeholder:"********",onBlur:a[2]||(a[2]=w=>c(n)("password")),onKeypress:a[3]||(a[3]=w=>c(n)("password"))},{append:N(()=>[u(P,{onClick:a[0]||(a[0]=w=>y()),class:"cursor-pointer",name:f.value,color:"primary"},null,8,["name"])]),_:1},8,["type","modelValue"])]),c(g).errors.password?(d(),p("p",_e,L(c(g).errors.password),1)):I("",!0)]),u(x,{onClick:R,disabled:!c(g).isvalid,label:"Guardar",size:"14px",fill:"",height:"48px",color:"primary",class:"full-width q-mb-md"},null,8,["disabled"])])]))])])]))}};export{be as default};
