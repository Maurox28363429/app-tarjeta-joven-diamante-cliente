import{V as $,l as r,a_ as T,au as S,aA as q,Y as P,Z as o,F as l,y as v,a4 as n,b3 as U,c5 as E,bR as L,J as V,aG as N,bs as _}from"./index.30f6a082.js";import{Q as R}from"./QInnerLoading.faf9b563.js";import{Q as j}from"./QImg.805f72db.js";import{Q as G}from"./QPagination.6fdcfb21.js";import{Q as J}from"./QTable.69aa52a4.js";import{i as D}from"./index.360ce4ab.js";import{u as Y}from"./userAuth.2f3f2794.js";import{u as Z}from"./userCart.afb4f77b.js";import{u as H}from"./useToast.a57f6721.js";import"./format.a33550d6.js";import"./QList.95cf641a.js";import"./QSelect.61c24c35.js";import"./QItemSection.e5fa1863.js";import"./QItemLabel.0fcf9e98.js";import"./position-engine.e4f37f04.js";import"./selection.a13f7bd0.js";import"./rtl.b51694b1.js";import"./axios.f1f32898.js";async function K({name:g="",id:i,page:d=1}){const{data:u}=await D.get(`/comercio-ofertas?comercio_id=${i}&nombre=${g}&page=${d}`);return u}async function X({comercio_id:g,total_descuento:i,ofertas:d,total:u,client_id:p}){const{data:h}=await D.post("/cliente-comercio-ofertas",{comercio_id:g,total_descuento:i,ofertas:d,total:u,client_id:p});return h}const ee={class:"q-ma-md body-large"},ae={class:"q-ma-md body-small",style:{color:"#363636"}},te={class:"orderContainer"},oe={class:"full-height q-mx-md"},le={class:"full-width q-mb-lg row justify-center q-mt-lg"},ne={class:"containerCard"},se={class:""},ie={class:"text-center column"},re={class:"q-ma-none text-weight-medium"},ce={class:"q-ma-none text-weight-medium"},de={class:"q-ma-none"},ue={class:"q-ma-none text-weight-medium"},pe={class:"q-ma-none"},me=o("p",{class:"q-ma-none",style:{display:"none"}},"F/l:",-1),ve={class:"q-ma-none",style:{display:"none"}},fe={class:"row items-center"},_e={class:"q-ma-none text-weight-medium",style:{padding:"0 7px"}},ge={class:"buttonAdd"},he={class:"q-pa-lg flex flex-center"},be={class:"full-width"},ye={class:"q-pa-md"},we={class:"q-ma-none body-large"},xe={class:"q-ma-none body-large"},ke={class:"buttonActions"},Ee={__name:"CreateOrderPage",setup(g){const{triggerPositive:i,triggerWarning:d}=H(),u=Z(),p=$(()=>u.client),{user:h}=Y(),m=r(""),f=r([]),y=r(!1),w=r(!1),W=r(1),b=r(1),c=r([]),s=r([]),x=$(()=>Math.round(100*s.value.reduce((a,e)=>a+e.priceTotal,0))/100),k=$(()=>Math.round(100*s.value.reduce((a,e)=>a+e.savings,0))/100);console.log(x,k);async function A(){const a=s.value.map(e=>({id:e.id,cantidad:e.cantidad}));try{w.value=!0;const{error:e}=await X({comercio_id:h.value.id,total_descuento:k,ofertas:a,total:x,client_id:u.client.id});e?d(e):i("Factura creada")}catch(e){console.error(e),d("Error al crear la factura")}finally{w.value=!1}}function I(){const a=s.value.filter(e=>!c.value.some(t=>t.id===e.id));s.value=a,c.value.length>0&&i("Producto eliminado")}function z(a){const e=f.value.find(t=>t.id===a);e&&(e.cantidad++,e.priceTotal=e.priceWidthDiscount*e.cantidad)}function B(a){console.log("restar",a);const e=f.value.find(t=>(console.log(t.id,a),t.id===a));console.log(e,"item"),e&&e.cantidad>1&&(e.cantidad--,e.priceTotal=e.priceWidthDiscount*e.cantidad,e.savings=e.savings*e.cantidad)}function F(a){const e=s.value.find(t=>t.id===a.id);e?(e.cantidad=a.cantidad+e.cantidad,e.priceTotal=a.priceWidthDiscount*e.cantidad,e.savings=a.savings*e.cantidad,i("Producto agregado")):(s.value.push({id:a.id,cantidad:a.cantidad,nombre:a.nombre,price_total:a.price_total,descuento:a.descuento,priceWidthDiscount:a.priceWidthDiscount,savings:a.savings,priceTotal:a.priceTotal}),i("Producto agregado"))}async function C(){try{y.value=!0;const a=await K({name:m.value,page:b.value,id:h.value.id});f.value=await a.data.map(e=>({...e,cantidad:1,priceWidthDiscount:e.price_total-e.descuento/100*e.price_total,savings:e.price_total-(e.price_total-e.descuento/100*e.price_total),priceTotal:e.price_total-e.descuento/100*e.price_total*1})),console.log(f.value,"offers")}catch(a){console.error(a)}finally{y.value=!1}}T(m,async a=>{await C()}),T(b,async a=>{await C()}),S(async()=>{C()});const M=[{name:"cantidad",align:"center",label:"Cantidad",field:"cantidad",sortable:!0},{name:"nombre",align:"center",label:"Producto",field:"nombre",sortable:!0},{name:"priceWidthDiscount",align:"center",label:"precio con descuento",field:"priceWidthDiscount",sortable:!0},{name:"savings",align:"center",label:"Ahorrado",field:"savings",sortable:!0},{name:"price_total",label:"Precio",field:"price_total",sortable:!0,format:a=>`$${a}`},{name:"descuento",label:"Descuento",field:"descuento",sortable:!0,format:a=>`${a}%`},{name:"priceTotal",label:"Precio total",field:"priceTotal",sortable:!0,format:a=>`$${a}`}];function O(){return c.value.length===0?"":`${c.value.length} record${c.value.length>1?"s":""} selected of ${s.value.length}`}return(a,e)=>(q(),P(V,null,[o("p",ee," Cliente: "+l(v(p)?v(p).name:"cliente no ingresado"),1),o("p",ae,l(v(p)?"":"Por favor ingrese el cliente a trav\xE9s del QR"),1),o("div",te,[o("div",oe,[o("div",le,[n(L,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=t=>m.value=t),outlined:"",type:"search",label:"Buscar ofertas",color:"primary",class:"full-width"},{append:U(()=>[n(E,{name:"search",modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t)},null,8,["modelValue"])]),_:1},8,["modelValue"])]),o("div",ne,[n(R,{showing:y.value,label:"Por favor espera...","label-class":"text-teal","label-style":"font-size: 1.1em"},null,8,["showing"]),(q(!0),P(V,null,N(f.value,t=>(q(),P("div",{class:"card",key:t.id},[o("div",se,[n(j,{class:"rounded-borders",src:t.img_array_url[0],"spinner-color":"dark",style:{height:"80px","max-width":"150px"}},null,8,["src"])]),o("div",null,[o("div",ie,[o("p",re,l(t.nombre),1),o("p",ce," $"+l(t.price_total),1)])]),o("div",null,[o("p",de,"Inventario: "+l(t.stock),1),o("p",ue," Precio $"+l(t.price_total),1),o("p",pe,"Desct: "+l(t.descuento)+"%",1),me,o("p",ve,l(t.fecha_tope_descuento),1)]),o("div",fe,[n(_,{color:"primary",icon:"add",size:"xs",round:"",disable:t.stock===0,onClick:Q=>z(t.id)},null,8,["disable","onClick"]),o("p",_e,l(t.cantidad),1),n(_,{color:"primary",icon:"remove",size:"xs",round:"",onClick:Q=>B(t.id)},null,8,["onClick"])]),o("div",ge,[n(_,{onClick:Q=>F(t),color:"positive",disable:t.stock===0,icon:"add",round:""},null,8,["onClick","disable"])])]))),128))]),o("div",he,[n(G,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),max:W.value},null,8,["modelValue","max"])])]),o("div",be,[o("div",ye,[o("p",we,"Total: $"+l(v(x)),1),o("p",xe,"Ahorro: $"+l(v(k)),1),n(J,{class:"my-sticky-virtscroll-table",flat:"",bordered:"","virtual-scroll":"","virtual-scroll-sticky-size-start":48,title:"Carrito",rows:s.value,columns:M,"row-key":"id","selected-rows-label":O,selection:"multiple",selected:c.value,"onUpdate:selected":e[3]||(e[3]=t=>c.value=t)},null,8,["rows","selected"]),o("div",ke,[n(_,{loading:w.value,color:"positive",label:"finalizar compra",onClick:A,disable:!v(p)||s.value.length===0},null,8,["loading","disable"]),n(_,{color:"negative",label:"eliminar",onClick:I})])])])])],64))}};export{Ee as default};
