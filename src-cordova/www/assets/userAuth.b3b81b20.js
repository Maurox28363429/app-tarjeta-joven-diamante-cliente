import{e as k,c as M,r as d,w as A,v as L,h as v,T as I,A as O,ae as W,af as j,ag as _}from"./index.639bd1b3.js";import{i as N,u as Q}from"./useToast.aab6b583.js";const $={ratio:[String,Number]};function H(e,i){return k(()=>{const r=Number(e.ratio||(i!==void 0?i.value:void 0));return isNaN(r)!==!0&&r>0?{paddingBottom:`${100/r}%`}:null})}const K=16/9;var J=M({name:"QImg",props:{...$,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:K},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:i,emit:r}){const o=d(e.initialRatio),l=H(e,o);let n=null,c=!1;const a=[d(null),d(f())],s=d(0),y=d(!1),S=d(!1),E=k(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),z=k(()=>({width:e.width,height:e.height})),B=k(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),g=k(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));A(()=>u(),m);function u(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function f(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function m(t){n!==null&&(clearTimeout(n),n=null),S.value=!1,t===null?(y.value=!1,a[s.value^1].value=f()):y.value=!0,a[s.value].value=t}function U({target:t}){c!==!0&&(n!==null&&(clearTimeout(n),n=null),o.value=t.naturalHeight===0?.5:t.naturalWidth/t.naturalHeight,w(t,1))}function w(t,q){c===!0||q===1e3||(t.complete===!0?C(t):n=setTimeout(()=>{n=null,w(t,q+1)},50))}function C(t){c!==!0&&(s.value=s.value^1,a[s.value].value=null,y.value=!1,S.value=!1,r("load",t.currentSrc||t.src))}function R(t){n!==null&&(clearTimeout(n),n=null),y.value=!1,S.value=!0,a[s.value].value=null,a[s.value^1].value=f(),r("error",t)}function b(t){const q=a[t].value,T={key:"img_"+t,class:B.value,style:g.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...q};return s.value===t?(T.class+=" q-img__image--waiting",Object.assign(T,{onLoad:U,onError:R})):T.class+=" q-img__image--loaded",v("div",{class:"q-img__container absolute-full",key:"img"+t},v("img",T))}function x(){return y.value!==!0?v("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},O(i[S.value===!0?"error":"default"])):v("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},i.loading!==void 0?i.loading():e.noSpinner===!0?void 0:[v(W,{color:e.spinnerColor,size:e.spinnerSize})])}return m(u()),L(()=>{c=!0,n!==null&&(clearTimeout(n),n=null)}),()=>{const t=[];return l.value!==null&&t.push(v("div",{key:"filler",style:l.value})),S.value!==!0&&(a[0].value!==null&&t.push(b(0)),a[1].value!==null&&t.push(b(1))),t.push(v(I,{name:"q-transition--fade"},x)),v("div",{class:E.value,style:z.value,role:"img","aria-label":e.alt},t)}}});function P({email:e,password:i}){return N.post("/login",{email:e,password:i})}function V({name:e,email:i,password:r,active:o,role_id:l,phone:n,last_name:c,sex:a,address:s}){return N.post("/register",{name:e,email:i,password:r,active:o,role_id:l,phone:n,last_name:c,sex:a,address:s})}function F({user_id:e}){return N.post("/prueba-membresia",{user_id:e})}const p=j("userAuth",{state:()=>{var e,i;return{user:((e=_.getUser())==null?void 0:e.user)||null,token:((i=_.getUser())==null?void 0:i.token)||null}},actions:{logout(){this.user=null,this.token=null,_.removeUser()},async login({email:e,password:i}){var o,l;const{data:r}=await P({email:e,password:i});this.user=r.user,this.token=r.token,_.setUser(r),((o=this.user.membresia)==null?void 0:o.status)==="activa"||((l=this.user.membresia)==null?void 0:l.days)>0?this.router.push("/products"):this.router.push("/products")},async register({name:e,email:i,last_name:r,phone:o,sex:l,password:n,role_id:c}){const{data:a}=await V({name:e,email:i,last_name:r,phone:o,sex:l,password:n,role_id:c});this.user=a.user,this.token=a.token,_.setUser(a),this.router.push("/products")},async addMembership({user_id:e}){const{data:i}=await F({user_id:e});this.user.membresia=i,_.setUser({user:this.user,token:this.token})}}}),h=()=>{const e=p(),i=d(!1),r=d(!1),o=d(!1),{token:l,user:n}=e,c=()=>{var g,u;return((g=h==null?void 0:h.user.membresia)==null?void 0:g.status)==="activa"||((u=h==null?void 0:h.user.membresia)==null?void 0:u.days)>0},{triggerPositive:a,triggerWarning:s}=Q();return{isActiveUser:()=>Boolean(h.user),membershipsIsActive:c,login:async({password:g,email:u})=>{var f;try{i.value=!0,await e.login({password:g,email:u}),a("Usuario iniciado con \xE9xito")}catch(m){((f=m.response)==null?void 0:f.status)===400&&s("Usuario no encontrado, por favor verifique sus datos e intente nuevamente"),m.code==="ERR_NETWORK"&&s("Verifique su conexi\xF3n a internet e intente nuevamente"),console.error(m)}finally{i.value=!1}},register:async({name:g,email:u,last_name:f,phone:m,sex:U,password:w,role_id:C})=>{var R;try{r.value=!0,await e.register({name:g,email:u,last_name:f,phone:m,sex:U,password:w,role_id:C}),a("Usuario registrado con \xE9xito")}catch(b){((R=b.response)==null?void 0:R.status)===400&&s("Ese usuario ya exite, por favor ingrese otro correo o n\xFAmero de tel\xE9fono"),b.code==="ERR_NETWORK"&&s("Verifique su conexi\xF3n a internet e intente nuevamente"),console.error(b)}finally{r.value=!1}},token:l,user:n,isLoadingLogin:i,isAuthenticated:()=>Boolean(l),isLoadingRegister:r,addMembership:async({user_id:g})=>{try{o.value=!0,await e.addMembership({user_id:g}),a("Ha obtenido la membres\xEDa con \xE9xito")}catch(u){u.code==="ERR_NETWORK"&&s("Verifique su conexi\xF3n a internet e intente nuevamente"),console.error(u)}finally{o.value=!1}},isLoadingMembership:o}};export{J as Q,h as u};
